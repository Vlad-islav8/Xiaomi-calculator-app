<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculator (HTML Only)</title>
  <link rel="stylesheet" href="./main.css" />
</head>
<body>
  <style>
    body {
  margin: 0;
  padding: 0;
  font-size: 16px
}

.app {
  width: 100%;
  height: 100vh;
  display: flex;
  flex-direction: column;
  max-width: 100vh;
  box-sizing: border-box;
  background-color: #212121
}

.appTable {
  max-width: 100vh;
  width: 100%;
  display: flex
}

.appTable input {
  color: white;
  padding: 0 0.5rem;
  font-size: 5rem;
  margin: 3rem 0 1rem 0;
  text-align: end;
  width: 100%;
  border: none;
  background: none;
  outline: none;
}

.appTable input:focus {
  background: none;
  border: none;
}

.appButtons {
  width: 100%;
  height: 100%;
}

.calculator-buttons {
  box-sizing: border-box;
  align-self: stretch;
  display: grid;
  grid-template-columns: 1fr 1fr 1fr 1fr;
  height: 100%;
  gap: 8px;
  padding: 0.5rem
}

.calculator-button {
  border-radius: 50px;
  font-size: 2rem;
  color: white;
  background-color: #3b3b3b;
  border: none
}

.zero {
  grid-column: 1 / span 2
}

.operator, .equal {
  background-color: #eb8d00;
}

.clear, .percent, .backspace {
  background-color: #9ddaf9;
  color: black
}
  </style>
  <div class="app">
    <div class="appTable">
      <input type="text" id="display" value="0" readonly>
    </div>
    
    <div class="appButtons">
      <div class="calculator-buttons" id="btnBar">
  <button class="calculator-button clear">C</button>
  <button class="calculator-button backspace">&#x232B;</button>
  <button class="calculator-button percent">%</button>
  <button class="calculator-button operator">/</button>

  <button class="calculator-button number">1</button>
  <button class="calculator-button number">2</button>
  <button class="calculator-button number">3</button>
  <button class="calculator-button operator">*</button>

  <button class="calculator-button number">4</button>
  <button class="calculator-button number">5</button>
  <button class="calculator-button number">6</button>
  <button class="calculator-button operator">-</button>

  <button class="calculator-button number">7</button>
  <button class="calculator-button number">8</button>
  <button class="calculator-button number">9</button>
  <button class="calculator-button operator">+</button>

  <button class="calculator-button number zero">0</button>
  <button class="calculator-button decimal">.</button>
  <button class="calculator-button equal">=</button>
</div>

    </div>
  </div>
  <script>
    // DOM Elements
const displayBar = document.querySelector("#display");
const btnBar = document.querySelector("#btnBar");
const calculatorButtonsContainer = document.querySelector('.calculator-buttons');

// Buttons
const clearButton = calculatorButtonsContainer.querySelector('.clear');
const backspaceButton = calculatorButtonsContainer.querySelector('.backspace');
const percentButton = calculatorButtonsContainer.querySelector('.percent');
const equalButton = calculatorButtonsContainer.querySelector('.equal');
const decimalButton = calculatorButtonsContainer.querySelector('.decimal');

const numberButtons = calculatorButtonsContainer.querySelectorAll('.number');
const operators = document.querySelectorAll(".operator");

// Initial Values
let currentState = {
    currentValue: "0",
    newCurrent: "",
    operator: null, 
    result: null,
    display: "0",
};
let {currentValue, newCurrent, operator, result, display} = currentState

const updateState = () => {
    currentState = {
        currentValue,
        newCurrent,
        operator,
        result,
        display
    }
}

displayBar.value = currentValue;

const updateDisplay = (current) => {
    currentState.display = current
    display = current;
    displayBar.value = current
    updateState()
}

const eventNumberCreator = (item) => {
    numberButtons[item].addEventListener('click', () => {
        const number = numberButtons[item].textContent; 
        if (operator === null) {
            currentValue = (currentValue === "0" ? "" : currentValue) + number;
            updateDisplay(currentValue)
        } else if(result) {
            currentValue = String(result)
            currentValue =  (currentValue === "0" ? "" : currentValue) + number;
            newCurrent = ""
            operator = null
            result = null
            updateDisplay(currentValue)
        }
          else {
          newCurrent = (newCurrent === "0" ? "" : newCurrent) + number
              updateDisplay(newCurrent)
        }
      });
    };

const eventOperatorsCreator = (item) => {
    operators[item].addEventListener("click", () => {
        if(currentValue && newCurrent){
            
            resultFunction(currentValue, operator, newCurrent)
            currentValue = Number(result)
            newCurrent = ""
            updateState()
            result = ""
            updateState()
            updateDisplay(currentValue)
            console.log(result)
        }
        else if(result) {
            currentValue = String(result)
            result = null
            newCurrent = ""
            updateDisplay(currentValue)
        }
        currentState.operator = operators[item].textContent;
        operator = operators[item].textContent;
        updateDisplay(operator)
        updateState()
       
    });

};

const matchFunction = (current, operator, newCurrent) => {
    current = Number(current);
    newCurrent = Number(newCurrent);
    let result;
    
    switch (operator) {
        case "+":
            result = current + newCurrent;
            break;
        case "-":
            result = current - newCurrent;
            break;
        case "*":
            result = current * newCurrent;
            break;
        case "/":
            result = current / newCurrent;
            break;
        case "%":
            result = current % newCurrent;
            break;
        default:
            console.warn("Unknown operator:", operator);  // Added for debugging
            return "hello world";
    }
    return result;
};

const resultFunction = (current, operator, newCurrent) => {
    const mathResult = matchFunction(current, operator, newCurrent);
    result = mathResult;
    updateState()
};

// Event Listeners
equalButton.addEventListener("click", () => {
    resultFunction(currentState.currentValue, currentState.operator, currentState.newCurrent); 
    updateDisplay(currentState.result)
    
});

clearButton.addEventListener("click", () => {
    currentValue = "0";
    newCurrent = "";
    operator = null;
    result = null;
    updateDisplay("0");
})

backspaceButton.addEventListener("click", () => {
    if (operator === null) {
        currentValue = currentValue.slice(0, -1);
        if (currentValue === "") {
            currentValue = "0";
        }
         updateDisplay(currentValue)
    } else {
        newCurrent = newCurrent.slice(0, -1);
        if (newCurrent === "") {
            newCurrent = "0";
        }
         updateDisplay(newCurrent)
    }
});

decimalButton.addEventListener("click", () => {
    if (operator === null) {
        if (!currentValue.includes(".")) {
            currentValue += ".";
             updateDisplay(currentValue)
        }
    } else {
        if (!newCurrent.includes(".")) {
            newCurrent += ".";
             updateDisplay(newCurrent)
        }
    }
});

percentButton.addEventListener("click", () => {
    if (operator === null) {
        currentValue = String(Number(currentValue) / 100);
        updateDisplay(currentValue)
    } else {
        newCurrent = String(Number(newCurrent) / 100);
        updateDisplay(newCurrent)
    }
});
//Number
for (let i = 0; i < numberButtons.length; i++) {
    eventNumberCreator(i);
  }

for (let i = 0; i < operators.length; i++) {
    eventOperatorsCreator(i);
  }  
  </script>
</body>
</html>
